{% extends 'base.html' %}

{% block title %}Mis Citas - System Citas{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="fas fa-calendar-check"></i> Mis Citas</h2>
        </div>
        <div class="col-md-4 text-end">
            <a href="{% url 'lista_especialidades' %}" class="btn btn-primary">
                <i class="fas fa-calendar-plus"></i> Agendar Nueva Cita
            </a>
        </div>
    </div>
    
    {% if citas %}
    <div class="row">
        {% for cita in citas %}
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm
                {% if cita.estado == 'pendiente' %}border-warning
                {% elif cita.estado == 'confirmada' %}border-success
                {% elif cita.estado == 'completada' %}border-info
                {% elif cita.estado == 'cancelada' %}border-danger
                {% endif %}">
                
                <div class="card-header 
                    {% if cita.estado == 'pendiente' %}bg-warning text-dark
                    {% elif cita.estado == 'confirmada' %}bg-success text-white
                    {% elif cita.estado == 'completada' %}bg-info text-white
                    {% elif cita.estado == 'cancelada' %}bg-danger text-white
                    {% endif %}">
                    <strong>{{ cita.get_estado_display|upper }}</strong>
                </div>
                
                <div class="card-body">
                    <h5 class="card-title">Dr. {{ cita.doctor.usuario.get_full_name }}</h5>
                    <p class="text-muted mb-2">
                        {% for esp in cita.doctor.especialidades.all %}
                            <span class="badge bg-primary">{{ esp.nombre }}</span>
                        {% endfor %}
                    </p>
                    
                    <hr>
                    
                    <p class="mb-2">
                        <i class="fas fa-calendar text-primary"></i> 
                        <strong>Fecha:</strong> {{ cita.fecha|date:"d/m/Y" }}
                    </p>
                    <p class="mb-2">
                        <i class="fas fa-clock text-info"></i> 
                        <strong>Hora:</strong> {{ cita.hora_inicio|time:"H:i" }}
                    </p>
                    <p class="mb-2">
                        <i class="fas fa-tag text-warning"></i> 
                        <strong>Tipo:</strong> {{ cita.get_tipo_display }}
                    </p>
                    <p class="mb-3">
                        <i class="fas fa-comment text-secondary"></i> 
                        <strong>Motivo:</strong> {{ cita.motivo|truncatewords:15 }}
                    </p>
                    
                    <div class="d-grid gap-2">
                        <a href="{% url 'detalle_cita' cita.id %}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i> Ver Detalles
                        </a>
                        
                        {% if cita.estado in 'pendiente,confirmada' %}
                        <a href="{% url 'cancelar_cita' cita.id %}" class="btn btn-sm btn-outline-danger"
                           onclick="return confirm('¿Estás seguro de cancelar esta cita?')">
                            <i class="fas fa-times"></i> Cancelar Cita
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> No tienes citas agendadas.
        <a href="{% url 'lista_especialidades' %}" class="alert-link">Agenda tu primera cita aquí</a>
    </div>
    {% endif %}
</div>
{% endblock %}